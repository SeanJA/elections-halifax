function clearMarkers(){if(markersArray)for(var e=0;e<markersArray.length;e++)markersArray[e].setMap(null)}function initialize(){geocoder=new google.maps.Geocoder;var e=new google.maps.LatLng(44.653024,-63.597107),t={zoom:11,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),t);var n=new google.maps.FusionTablesLayer({query:{select:"col2",from:"1QKmWKHvGOcq4qzKAokl4FhyMcaf1Oqug2iDxtxc"}});n.setMap(map),google.maps.event.addListener(n,"click",function(e){clearMarkers(),loadData(e.latLng)})}function codeAddress(){var e=document.getElementById("postal-code").value+" Nova Scotia, Canada";geocoder.geocode({address:e},function(e,t){if(t==google.maps.GeocoderStatus.OK){map.setCenter(e[0].geometry.location);var n=new google.maps.Marker({map:map,position:e[0].geometry.location,icon:"images/house.png"});markersArray.push(n),loadData(e[0].geometry.location)}else alert("Geocode was not successful for the following reason: "+t)})}function loadData(e){$.ajax({type:"GET",url:"get-district.php",data:{"long":e.Ya,lat:e.Xa},dataType:"json"}).done(function(e){addPollingStations(polling_stations[e]),addDistrictData(districts[e]),loadedDistrict=e})}function addPollingStations(e){for(i in e){var t=e[i];if(t){var n=new google.maps.LatLng(t.lat,t["long"]),r="<b>"+t.place_name+"</b>"+"<p>"+t.address+", "+t.city+"</p>",s=new google.maps.Marker({map:map,position:n,title:t.place_name,icon:"images/administration.png"});listenMarker(s,r),markersArray.push(s)}}}function addDistrictData(e){if(e){string="",string+="<h5>"+e.district+": "+e.name+"</h5>",string+="<h6>Voters: "+e.voters+"</h6>",string+="<h6> Candidates: </h6>";for(i in e.candidates)if(typeof e["candidates"][i]!="undefined"){var t=e.candidates[i];string+="<strong>"+t.name+"</strong>",string+="<ul>",t.site!==""&&(string+='<li>Website : <a target="_blank" href="'+t.site+'">'+t.site+"</a></li>"),t.twitter!==""&&(string+='<li>Twitter : <a target="_blank" href="https://twitter.com/'+t.twitter+'">'+t.twitter+"</a></li>"),t.email!==""&&(string+='<li>Email : <a target="_blank" href="mailto:'+t.email+'">'+t.email+"</a></li>"),string+="</ul>"}$("#district-data").html(string).addClass("panel")}}function listenMarker(e,t){google.maps.event.addListener(e,"click",function(n){tooltip&&tooltip.close(),tooltip=new google.maps.InfoWindow({content:t}),tooltip.open(map,e)})}var geocoder,map,markersArray=[],tooltip=null,loadedDistrict=null;(function(e){e(function(){e(document).foundationNavigation(),initialize(),e("#find-it").click(function(){e("#district-data").html("").removeClass("panel"),clearMarkers(),codeAddress(),window.location.hash="map-canvas"})})})(jQuery);